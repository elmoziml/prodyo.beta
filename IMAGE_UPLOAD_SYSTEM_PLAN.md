# ๐ธ ุฎุทุฉ ูุธุงู ุฑูุน ูุชุฎุฒูู ุงูุตูุฑ

## ๐ฏ ุงููุฏู
ุชุญููู ูุธุงู ุงูุตูุฑ ูู ุฑูุงุจุท ุฎุงุฑุฌูุฉ ุฅูู ูุธุงู ุฑูุน ูุชุฎุฒูู ูุญูู ุจุงุณุชุฎุฏุงู `fs` (File System).

---

## ๐ ุชุญููู ุงููุถุน ุงูุญุงูู

### โ ูุง ูู ููุฌูุฏ:
1. **AddProductForm.tsx**: ูุณุชูุจู ุฑูุงุจุท ุงูุตูุฑ ููุท (URL)
2. **EditProductForm.tsx**: ูุนุฏู ุฑูุงุจุท ุงูุตูุฑ
3. **API Route** (`/api/products/route.ts`): ูุณุชุฎุฏู `fs` ููุฑุงุกุฉ/ูุชุงุจุฉ `products.json`
4. **ูุฌูุฏ public**: ูุญุชูู ุนูู `g19-5.png` ููุท
5. **products.json**: ูุฎุฒู ูุณุงุฑุงุช ุงูุตูุฑ ูู strings

### โ ูุง ูู ููููุฏ:
1. ูุธุงู ุฑูุน ุงููููุงุช (File Upload)
2. ูุฌูุฏุงุช ูุชุฎุฒูู ุงูุตูุฑ
3. API endpoint ูุฑูุน ุงูุตูุฑ
4. ูููู ูุงุฎุชูุงุฑ ุงููููุงุช ุจุฏูุงู ูู ุฅุฏุฎุงู ุฑูุงุจุท
5. ูุธุงู ุญุฐู ุงูุตูุฑ ูู ุงููููุงุช

---

## ๐๏ธ ุงูุจููุฉ ุงูููุชุฑุญุฉ

### ๐ ูููู ุงููุฌูุฏุงุช ุงูุฌุฏูุฏ

```
/home/fares/for-work/Elmoziml/prodyo.beta/
โโโ public/
โ   โโโ uploads/                    # ูุฌูุฏ ุฑุฆูุณู ููุตูุฑ ุงููุฑููุนุฉ
โ       โโโ products/               # ูุฌูุฏ ุงูููุชุฌุงุช
โ           โโโ prod-1234567890/    # ูุฌูุฏ ููู ููุชุฌ (ID)
โ           โ   โโโ image-1.jpg
โ           โ   โโโ image-2.jpg
โ           โ   โโโ image-3.png
โ           โโโ prod-9876543210/
โ           โ   โโโ main.jpg
โ           โ   โโโ thumb.jpg
โ           โโโ .gitkeep
โโโ src/
โ   โโโ app/
โ   โ   โโโ api/
โ   โ       โโโ products/
โ   โ       โ   โโโ route.ts              # ููุฌูุฏ (ุณูุชู ุชุนุฏููู)
โ   โ       โ   โโโ [id]/
โ   โ       โ   โ   โโโ route.ts          # ููุฌูุฏ (ุณูุชู ุชุนุฏููู)
โ   โ       โ   โโโ upload/
โ   โ       โ       โโโ route.ts          # ุฌุฏูุฏ - ุฑูุน ุงูุตูุฑ
โ   โ       โโโ images/
โ   โ           โโโ [productId]/
โ   โ               โโโ [imageId]/
โ   โ                   โโโ route.ts      # ุฌุฏูุฏ - ุญุฐู ุตูุฑุฉ
โ   โโโ components/
โ   โ   โโโ products/
โ   โ       โโโ AddProductForm.tsx        # ุณูุชู ุชุนุฏููู
โ   โ       โโโ EditProductForm.tsx       # ุณูุชู ุชุนุฏููู
โ   โ       โโโ ImageUploader.tsx         # ุฌุฏูุฏ - ูููู ุฑูุน ุงูุตูุฑ
โ   โโโ lib/
โ   โ   โโโ utils/
โ   โ       โโโ fileUpload.ts             # ุฌุฏูุฏ - ุฏูุงู ูุณุงุนุฏุฉ
โ   โโโ types/
โ       โโโ index.ts                      # ุณูุชู ุชุนุฏููู
```

---

## ๐ง ุงูููููุงุช ุงููุทููุจุฉ

### 1๏ธโฃ **API Endpoint ูุฑูุน ุงูุตูุฑ**
**ุงููุณุงุฑ:** `/api/products/upload/route.ts`

**ุงููุธููุฉ:**
- ุงุณุชูุจุงู ูููุงุช ุงูุตูุฑ (multipart/form-data)
- ุงูุชุญูู ูู ููุน ุงูููู (jpg, png, webp, gif)
- ุงูุชุญูู ูู ุญุฌู ุงูููู (max 5MB)
- ุฅูุดุงุก ูุฌูุฏ ููููุชุฌ ุฅุฐุง ูู ููู ููุฌูุฏุงู
- ุญูุธ ุงูุตูุฑุฉ ูู ุงููุฌูุฏ
- ุฅุฑุฌุงุน ูุณุงุฑ ุงูุตูุฑุฉ

**ุงููุฏุฎูุงุช:**
```typescript
{
  productId: string,      // ID ุงูููุชุฌ
  file: File,            // ุงูููู
  imageIndex?: number    // ุฑูู ุงูุตูุฑุฉ (ุงุฎุชูุงุฑู)
}
```

**ุงููุฎุฑุฌุงุช:**
```typescript
{
  success: true,
  imagePath: "/uploads/products/prod-123/image-1.jpg",
  imageUrl: "http://localhost:3000/uploads/products/prod-123/image-1.jpg"
}
```

---

### 2๏ธโฃ **API Endpoint ูุญุฐู ุงูุตูุฑ**
**ุงููุณุงุฑ:** `/api/images/[productId]/[imageId]/route.ts`

**ุงููุธููุฉ:**
- ุญุฐู ุงูุตูุฑุฉ ูู ุงููููุงุช
- ุชุญุฏูุซ `products.json` ูุฅุฒุงูุฉ ูุณุงุฑ ุงูุตูุฑุฉ
- ุญุฐู ุงููุฌูุฏ ุฅุฐุง ูุงู ูุงุฑุบุงู

**ุงููุฏุฎูุงุช:**
```typescript
{
  productId: string,
  imageId: string  // ุงุณู ุงูููู
}
```

**ุงููุฎุฑุฌุงุช:**
```typescript
{
  success: true,
  message: "Image deleted successfully"
}
```

---

### 3๏ธโฃ **ูููู ImageUploader**
**ุงููุณุงุฑ:** `src/components/products/ImageUploader.tsx`

**ุงููุธููุฉ:**
- ุนุฑุถ ููุทูุฉ Drag & Drop
- ูุนุงููุฉ ุงูุตูุฑ ูุจู ุงูุฑูุน
- ุนุฑุถ ุงูุตูุฑ ุงููุฑููุนุฉ ูุน ุฒุฑ ุญุฐู
- ุฏุนู ุฑูุน ูุชุนุฏุฏ
- ุนุฑุถ progress bar ุฃุซูุงุก ุงูุฑูุน

**ุงููุงุฌูุฉ:**
```tsx
interface ImageUploaderProps {
  productId: string;
  images: string[];           // ุงูุตูุฑ ุงูุญุงููุฉ
  onImagesChange: (images: string[]) => void;
  maxImages?: number;         // ุงูุญุฏ ุงูุฃูุตู (default: 10)
  maxSizeInMB?: number;       // ุงูุญุฌู ุงูุฃูุตู (default: 5)
}
```

---

### 4๏ธโฃ **ุฏูุงู ูุณุงุนุฏุฉ (Utilities)**
**ุงููุณุงุฑ:** `src/lib/utils/fileUpload.ts`

**ุงูุฏูุงู:**

```typescript
// ุงูุชุญูู ูู ููุน ุงูููู
export function isValidImageType(file: File): boolean;

// ุงูุชุญูู ูู ุญุฌู ุงูููู
export function isValidImageSize(file: File, maxSizeInMB: number): boolean;

// ุฅูุดุงุก ุงุณู ูุฑูุฏ ููููู
export function generateUniqueFileName(originalName: string): string;

// ุฅูุดุงุก ูุฌูุฏ ุฅุฐุง ูู ููู ููุฌูุฏุงู
export function ensureDirectoryExists(dirPath: string): void;

// ุญุฐู ูุฌูุฏ ุฅุฐุง ูุงู ูุงุฑุบุงู
export function deleteEmptyDirectory(dirPath: string): void;

// ุญุฐู ุฌููุน ุตูุฑ ููุชุฌ
export function deleteProductImages(productId: string): Promise<void>;
```

---

## ๐ ุฎุทูุงุช ุงูุชูููุฐ (ุจุงูุชุฑุชูุจ)

### ุงููุฑุญูุฉ 1: ุงูุจููุฉ ุงูุชุญุชูุฉ โ๏ธ

#### โ ุงูุฎุทูุฉ 1.1: ุฅูุดุงุก ุงููุฌูุฏุงุช
```bash
mkdir -p public/uploads/products
touch public/uploads/products/.gitkeep
```

#### โ ุงูุฎุทูุฉ 1.2: ุฅูุดุงุก ููู ุงูุฏูุงู ุงููุณุงุนุฏุฉ
- ุฅูุดุงุก `src/lib/utils/fileUpload.ts`
- ุฅุถุงูุฉ ุฌููุน ุงูุฏูุงู ุงููุณุงุนุฏุฉ

#### โ ุงูุฎุทูุฉ 1.3: ุชุญุฏูุซ Types
- ุฅุถุงูุฉ interfaces ุฌุฏูุฏุฉ ูู `src/types/index.ts`

---

### ุงููุฑุญูุฉ 2: API Endpoints ๐

#### โ ุงูุฎุทูุฉ 2.1: ุฅูุดุงุก Upload API
- ุฅูุดุงุก `/api/products/upload/route.ts`
- ุฏุนู multipart/form-data
- ุญูุธ ุงููููุงุช ูู ุงููุฌูุฏุงุช

#### โ ุงูุฎุทูุฉ 2.2: ุฅูุดุงุก Delete Image API
- ุฅูุดุงุก `/api/images/[productId]/[imageId]/route.ts`
- ุญุฐู ุงูููู + ุชุญุฏูุซ JSON

#### โ ุงูุฎุทูุฉ 2.3: ุชุญุฏูุซ Products API
- ุชุนุฏูู `POST` ูู `/api/products/route.ts`
- ุชุนุฏูู `PUT` ูู `/api/products/[id]/route.ts`
- ุชุนุฏูู `DELETE` ูุญุฐู ุงูุตูุฑ ุนูุฏ ุญุฐู ุงูููุชุฌ

---

### ุงููุฑุญูุฉ 3: ุงูููููุงุช (Components) ๐จ

#### โ ุงูุฎุทูุฉ 3.1: ุฅูุดุงุก ImageUploader Component
- Drag & Drop zone
- ูุนุงููุฉ ุงูุตูุฑ
- Progress bar
- ุฒุฑ ุญุฐู ููู ุตูุฑุฉ

#### โ ุงูุฎุทูุฉ 3.2: ุชุญุฏูุซ AddProductForm
- ุงุณุชุจุฏุงู input URL ุจู ImageUploader
- ุฅุฒุงูุฉ validation ููู URL
- ุฅุถุงูุฉ state ููุตูุฑ ุงููุฑููุนุฉ

#### โ ุงูุฎุทูุฉ 3.3: ุชุญุฏูุซ EditProductForm
- ููุณ ุงูุชุนุฏููุงุช
- ุนุฑุถ ุงูุตูุฑ ุงูุญุงููุฉ
- ุงูุณูุงุญ ุจุฅุถุงูุฉ/ุญุฐู ุตูุฑ

---

### ุงููุฑุญูุฉ 4: ุงูุฎุฏูุงุช (Services) ๐ง

#### โ ุงูุฎุทูุฉ 4.1: ุฅุถุงูุฉ ุฏูุงู ูู productService
```typescript
export const uploadProductImage = async (productId: string, file: File)
export const deleteProductImage = async (productId: string, imageId: string)
```

---

### ุงููุฑุญูุฉ 5: ุงูุงุฎุชุจุงุฑ ูุงูุชุญุณูู โจ

#### โ ุงูุฎุทูุฉ 5.1: ุงุฎุชุจุงุฑ ุงูุฑูุน
- ุฑูุน ุตูุฑุฉ ูุงุญุฏุฉ
- ุฑูุน ุตูุฑ ูุชุนุฏุฏุฉ
- ุฑูุน ููู ูุจูุฑ (ูุฌุจ ุฃู ููุดู)
- ุฑูุน ููู ุบูุฑ ุตูุฑุฉ (ูุฌุจ ุฃู ููุดู)

#### โ ุงูุฎุทูุฉ 5.2: ุงุฎุชุจุงุฑ ุงูุญุฐู
- ุญุฐู ุตูุฑุฉ ูุงุญุฏุฉ
- ุญุฐู ุฌููุน ุงูุตูุฑ
- ุญุฐู ููุชุฌ (ูุฌุจ ุญุฐู ูุฌูุฏู)

#### โ ุงูุฎุทูุฉ 5.3: ุงุฎุชุจุงุฑ ุงูุชุนุฏูู
- ุฅุถุงูุฉ ุตูุฑ ูููุชุฌ ููุฌูุฏ
- ุญุฐู ุตูุฑ ูู ููุชุฌ ููุฌูุฏ
- ุงุณุชุจุฏุงู ุงูุตูุฑ

---

## ๐ ุงูุฃูุงู ูุงูุชุญูู

### Validations ุงููุทููุจุฉ:

1. **ููุน ุงูููู:**
   - โ jpg, jpeg, png, webp, gif
   - โ exe, pdf, doc, etc.

2. **ุญุฌู ุงูููู:**
   - โ ุฃูู ูู 5MB
   - โ ุฃูุจุฑ ูู 5MB

3. **ุนุฏุฏ ุงูุตูุฑ:**
   - โ ุญุฏ ุฃูุตู 10 ุตูุฑ ููู ููุชุฌ
   - โ ุฃูุซุฑ ูู 10 ุตูุฑ

4. **ุฃุณูุงุก ุงููููุงุช:**
   - ุงุณุชุฎุฏุงู UUID ุฃู timestamp
   - ููุน ุงูุฃุญุฑู ุงูุฎุงุตุฉ
   - ุงูุญูุงุธ ุนูู ุงูุงูุชุฏุงุฏ ุงูุฃุตูู

---

## ๐ฆ ุงูููุชุจุงุช ุงููุทููุจุฉ

### โ ููุฌูุฏุฉ ุจุงููุนู:
- `fs` (Node.js built-in)
- `path` (Node.js built-in)
- `next` (ูุฏุนู API Routes)

### โ ูุฏ ูุญุชุงุฌ (ุงุฎุชูุงุฑู):
- `formidable` - ููุนุงูุฌุฉ multipart/form-data (ุฅุฐุง ูู ูุนูู Next.js built-in)
- `sharp` - ูุชุญุณูู ูุถุบุท ุงูุตูุฑ
- `uuid` - ูุฅูุดุงุก ุฃุณูุงุก ูุฑูุฏุฉ

**ููุงุญุธุฉ:** Next.js 15 ูุฏุนู FormData ุจุดูู ูุฏูุฌุ ูุฐุง ูุฏ ูุง ูุญุชุงุฌ ููุชุจุงุช ุฅุถุงููุฉ.

---

## ๐จ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู (UX)

### ูู AddProductForm:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ธ ุตูุฑ ุงูููุชุฌ                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  ๐ผ๏ธ  ุงุณุญุจ ุงูุตูุฑ ููุง          โ  โ
โ  โ     ุฃู ุงุถุบุท ููุงุฎุชูุงุฑ          โ  โ
โ  โ  (ุญุฏ ุฃูุตู 10 ุตูุฑุ 5MB ููู)   โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                     โ
โ  ุงูุตูุฑ ุงููุฑููุนุฉ:                   โ
โ  โโโโโโ โโโโโโ โโโโโโ              โ
โ  โ ๐ผ๏ธ โ โ ๐ผ๏ธ โ โ ๐ผ๏ธ โ              โ
โ  โ โ โ โ โ โ โ โ โ              โ
โ  โโโโโโ โโโโโโ โโโโโโ              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุฃุซูุงุก ุงูุฑูุน:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ุฌุงุฑู ุฑูุน ุงูุตูุฑ...                 โ
โ  โโโโโโโโโโโโโโโโโโโโ  60%          โ
โ  (3 ูู 5 ุตูุฑ ุชู ุฑูุนูุง)             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุชุญุฏูุซ products.json

### ูุจู:
```json
{
  "id": "prod-123",
  "name": "ูููุต",
  "images": [
    "https://example.com/image1.jpg",
    "https://example.com/image2.jpg"
  ]
}
```

### ุจุนุฏ:
```json
{
  "id": "prod-123",
  "name": "ูููุต",
  "images": [
    "/uploads/products/prod-123/image-1.jpg",
    "/uploads/products/prod-123/image-2.jpg"
  ]
}
```

---

## โ๏ธ ุงูุชุญุฏูุงุช ุงููุชููุนุฉ

### 1. ุญุฌู ุงููููุงุช
**ุงููุดููุฉ:** Next.js ูู ุญุฏ ุงูุชุฑุงุถู ูุญุฌู ุงูุทูุจุงุช (4MB)
**ุงูุญู:** ุชุนุฏูู `next.config.ts`:
```typescript
export default {
  api: {
    bodyParser: {
      sizeLimit: '10mb',
    },
  },
}
```

### 2. FormData ูู Server Components
**ุงููุดููุฉ:** FormData ูุนูู ููุท ูู Client Components
**ุงูุญู:** ุงุณุชุฎุฏุงู `'use client'` ูู ุงูููููุงุช

### 3. ุงูุตูุฑ ุงููุฏููุฉ
**ุงููุดููุฉ:** ุงูููุชุฌุงุช ุงูุญุงููุฉ ุชุณุชุฎุฏู ุฑูุงุจุท ุฎุงุฑุฌูุฉ
**ุงูุญู:** 
- ุฏุนู ููุง ุงููุธุงููู (ุฑูุงุจุท + ูููุงุช ูุญููุฉ)
- ุฃู migration script ูุชุญููู ุงูุฑูุงุจุท

### 4. Git ู ุงูุตูุฑ
**ุงููุดููุฉ:** ุฑูุน ุงูุตูุฑ ุฅูู Git ุณูุฒูุฏ ุญุฌู ุงูุฑูุจู
**ุงูุญู:** ุฅุถุงูุฉ `/public/uploads/` ุฅูู `.gitignore`

---

## ๐ ุงูููุงุฆุฏ ุงููุชููุนุฉ

### โ ูููุทูุฑ:
1. ุชุญูู ูุงูู ูู ุงูุตูุฑ
2. ูุง ุงุนุชูุงุฏ ุนูู ุฎุฏูุงุช ุฎุงุฑุฌูุฉ
3. ุณุฑุนุฉ ุฃูุจุฑ (ุงูุตูุฑ ูุญููุฉ)
4. ุณูููุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู

### โ ูููุณุชุฎุฏู:
1. ุฑูุน ุณูู (Drag & Drop)
2. ูุนุงููุฉ ููุฑูุฉ
3. ุญุฐู ูุฅุถุงูุฉ ุณุฑูุน
4. ูุง ุญุงุฌุฉ ูุฑูุน ุงูุตูุฑ ููููุน ุขุฎุฑ ุฃููุงู

### โ ููุฃุฏุงุก:
1. ุชุญููู ุฃุณุฑุน (Next.js Image Optimization)
2. ุฅููุงููุฉ ุถุบุท ุงูุตูุฑ
3. ุฅููุงููุฉ ุฅูุดุงุก thumbnails

---

## ๐ Checklist ุงูุชูููุฐ

- [ ] ุฅูุดุงุก ุงููุฌูุฏุงุช
- [ ] ุฅูุดุงุก fileUpload.ts utilities
- [ ] ุฅูุดุงุก Upload API endpoint
- [ ] ุฅูุดุงุก Delete Image API endpoint
- [ ] ุชุญุฏูุซ Products API (POST/PUT/DELETE)
- [ ] ุฅูุดุงุก ImageUploader component
- [ ] ุชุญุฏูุซ AddProductForm
- [ ] ุชุญุฏูุซ EditProductForm
- [ ] ุฅุถุงูุฉ ุฏูุงู ูู productService
- [ ] ุชุญุฏูุซ Types
- [ ] ุงุฎุชุจุงุฑ ุงูุฑูุน
- [ ] ุงุฎุชุจุงุฑ ุงูุญุฐู
- [ ] ุงุฎุชุจุงุฑ ุงูุชุนุฏูู
- [ ] ุชุญุฏูุซ next.config.ts
- [ ] ุฅุถุงูุฉ /uploads ุฅูู .gitignore
- [ ] ูุชุงุจุฉ ุงูุชูุซูู

---

## ๐ฏ ุงูุฎูุงุตุฉ

ูุฐุง ุงููุธุงู ุณูุญูู ุงููุดุฑูุน ูู ุงูุงุนุชูุงุฏ ุนูู ุฑูุงุจุท ุฎุงุฑุฌูุฉ ุฅูู ูุธุงู ุฑูุน ูุญูู ูุงูู ุจุงุณุชุฎุฏุงู `fs`. 

**ุงูููุช ุงููุชููุน ููุชูููุฐ:** 4-6 ุณุงุนุงุช ุนูู

**ุงูุฃููููุฉ:** ูุชูุณุทุฉ ุฅูู ุนุงููุฉ (ุญุณุจ ุงูุญุงุฌุฉ)

**ุงูุตุนูุจุฉ:** ูุชูุณุทุฉ

---

## ๐ ูู ุชุฑูุฏ ุงูุจุฏุกุ

ุงุฎุชุฑ ุฃุญุฏ ุงูุฎูุงุฑุงุช:
1. โ **ูุนูุ ุงุจุฏุฃ ุงูุขู** - ุณุฃุจุฏุฃ ุจุงูุชูููุฐ ุฎุทูุฉ ุจุฎุทูุฉ
2. ๐ **ุฃุฑูุฏ ุชุนุฏููุงุช ุนูู ุงูุฎุทุฉ** - ุฃุฎุจุฑูู ุจุงูุชุนุฏููุงุช
3. โ **ูุฏู ุฃุณุฆูุฉ** - ุงุณุฃู ุนู ุฃู ุฌุฒุก ุบูุฑ ูุงุถุญ
